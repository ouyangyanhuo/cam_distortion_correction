# AI Rule: 摄像头标定和参数调整工具

## 项目概述

这是一个基于WebUI的摄像头标定和参数调整工具，用于摄像头畸变校正和参数优化。项目使用Python作为后端，WebUI作为前端界面，具有简单易用的结构。

## 项目架构

### 技术栈
- **前端**: WebUI
- **后端**: Python
- **计算机视觉**: OpenCV
- **标定板**: ChArUco标定板 (A4纸张)

### 核心功能模块

#### 1. 标定板加载模块
- **功能**: 加载本地的Charuco_A4.pdf文件
- **标定板规格**:
  - 纸张: A4 (210 × 297 mm)
  - 字典: DICT_4X4_1000
  - 棋盘格: 7 × 10
  - squareLength = 25.0 mm
  - ArUco标记: markerLength = 17.5 mm (方格的70%)

#### 2. 摄像头管理模块
- **功能**: 摄像头选择和管理
- **支持**: 自动检测可用摄像头
- **操作**: 启动/停止摄像头

#### 3. 实时视频显示模块
- **功能**: 显示摄像头实时画面
- **位置**: 屏幕右侧
- **要求**: 实时更新，低延迟

#### 4. 摄像头参数调整模块
- **分辨率调整**: 宽度和高度可调
- **帧率调整**: 支持不同帧率设置
- **曝光模式**:
  - 自动曝光模式
  - 手动曝光模式
  - 手动曝光参数设置 (仅在手动模式下可用)
- **畸变矫正参数调节**: 实时调节畸变参数

#### 5. 代码生成模块
- **功能**: 根据调整后的参数生成C++代码
- **输出**: 可直接使用的C++代码片段
- **内容**: 包含摄像头内参矩阵和畸变系数

## 详细功能规范

### 1. 标定板处理
- 使用OpenCV的`cv2.aruco.CharucoBoard`创建标定板对象
- 参数设置:
  - `squaresX = 7`
  - `squaresY = 10`
  - `squareLength = 25.0`
  - `markerLength = 17.5`
  - `dictionary = cv2.aruco.DICT_4X4_1000`

### 2. 摄像头参数控制
- **分辨率**: 支持常见分辨率设置 (如640×480, 1280×720, 1920×1080等)
- **帧率**: 支持15, 30, 60 FPS等设置
- **曝光控制**:
  - 自动模式: `CAP_PROP_AUTO_EXPOSURE = 0.75`
  - 手动模式: `CAP_PROP_AUTO_EXPOSURE = 0.25`
  - 手动曝光值: `CAP_PROP_EXPOSURE` (范围-10到0)

### 3. 畸变矫正
- 使用标定板进行摄像头标定
- 计算内参矩阵和畸变系数
- 实时应用畸变矫正

### 4. C++代码生成
- 生成包含标定参数的C++代码
- 代码应包含:
  - 摄像头内参矩阵
  - 畸变系数矩阵
  - 基本的图像矫正示例

## 界面设计要求

### 布局
- 左侧: 标定板显示区域
- 右侧: 实时视频显示区域和参数调节面板

### 标定板显示区域
- 加载并显示Charuco_A4.pdf文件内容
- 显示标定板参数信息 (A4纸张，DICT_4X4_1000字典，7×10棋盘格，25.0mm方格长度，17.5mm标记长度)
- 提供标定板打印说明

### 视频显示和参数调节区域
- 实时显示摄像头画面
- 可叠加显示检测到的标定板标记
- 摄像头参数调节控件:
  - 摄像头选择下拉框
  - 分辨率输入框 (宽度, 高度)
  - 帧率选择
  - 曝光模式单选按钮 (自动/手动)
  - 手动曝光参数滑块 (当选择手动模式时启用)
  - 畸变矫正参数调节
  - 标定按钮
  - C++代码生成按钮
- 显示当前摄像头参数状态

## 数据流

1. 用户选择摄像头
2. 系统加载Charuco_A4.pdf标定板参数
3. 启动摄像头并显示实时画面
4. 用户调整摄像头参数
5. 系统实时应用参数并更新显示
6. 用户进行标定操作
7. 生成C++代码

## 技术实现要求

### 依赖库
- OpenCV (用于计算机视觉处理)
- Gradio (用于WebUI)
- NumPy (用于数值计算)

### 性能要求
- 实时视频显示延迟 < 100ms
- 参数调整响应 < 50ms
- 标定计算时间 < 5秒

### 兼容性
- 支持Windows, Linux, macOS
- 支持多种摄像头型号
- 支持不同分辨率的摄像头

## 错误处理

- 摄像头无法打开时显示错误信息
- 标定失败时提供重试选项
- 参数超出范围时进行限制

## 扩展性

- 支持不同类型的标定板
- 可添加更多摄像头参数
- 支持批量标定
- 可导出标定结果文件

## 项目结构

```
fixCam/
├── main.py          # 主程序入口
├── AI_Rule.md       # 项目开发基础规则 (本文件)
├── calibrator.py    # 摄像头标定类
├── ui.py           # WebUI界面
├── Charuco_A4.pdf  # 标定板PDF文件
└── requirements.txt # 依赖库列表
```

## 开发规范

- 代码应遵循PEP 8规范
- 函数和类应有适当的文档字符串
- 关键操作应有日志记录
- 错误处理应完善
- 代码应易于维护和扩展