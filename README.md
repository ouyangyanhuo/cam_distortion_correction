# 摄像头标定和参数调整工具

这是一个基于WebUI的摄像头标定和参数调整工具，用于摄像头畸变校正和参数优化。项目使用Python + Flask作为后端，WebUI作为前端界面。

## 功能特性

- **多种标定板支持**：支持ChArUco标定板和棋盘格标定板
- **摄像头管理**：自动检测可用摄像头，支持参数调整
- **实时预览**：实时显示摄像头画面，叠加检测到的标定板角点
- **参数调整**：调整摄像头参数（分辨率、帧率、曝光模式、曝光值等）
- **畸变校正**：支持针孔模型和鱼眼模型的摄像头标定
- **参数可视化**：实时应用畸变校正参数预览效果
- **标定结果导出**：生成C++代码，支持标定结果保存为YAML文件

## 系统要求

- Python 3.7+
- OpenCV (包含aruco模块)
- Flask
- NumPy

## 安装依赖

```bash
pip install -r requirements.txt
```

## 快速开始

### 启动应用

```bash
python app.py
```

应用将在 `http://127.0.0.1:5000` 上运行。

### 使用流程

1. **准备标定板**：打印项目中的 [Charuco_A4.pdf](Charuco_A4.pdf) 或使用棋盘格标定板
2. **选择摄像头**：从下拉菜单中选择要标定的摄像头
3. **调整参数**：设置合适的分辨率、帧率和曝光参数
4. **捕获标定图像**：将标定板放置在不同角度和位置，点击"捕获标定图像"，建议至少捕获10张以上
5. **执行标定**：点击"执行标定"完成摄像头标定
6. **预览效果**：标定完成后可实时查看畸变校正效果
7. **导出结果**：可生成C++代码或将标定结果保存为YAML文件

## 重构后的项目结构

```
fixCam/
├── app.py              # Flask主程序入口，提供Web API和界面
├── requirements.txt    # 依赖库列表
├── Charuco_A4.pdf     # A4纸张ChArUco标定板
├── .gitignore         # Git忽略配置
├── README.md          # 说明文档
├── src/               # 重构后的源代码模块
│   ├── __init__.py    # 模块初始化文件
│   ├── main_calibrator.py  # 重构后的主标定器类
│   ├── camera.py      # 摄像头管理模块
│   ├── board.py       # 标定板管理模块
│   ├── calibration.py # 标定核心算法模块
│   ├── detection.py   # 角点检测算法模块
│   └── utils.py       # 工具函数模块
└── templates/         # Flask模板目录
    └── index.html     # Web界面
```

## 模块说明

### src/main_calibrator.py
重构后的主标定器类，整合了各个功能模块，提供统一的接口。

### src/camera.py
摄像头管理模块，包含摄像头初始化、参数调整、视频流处理等功能。

### src/board.py
标定板管理模块，处理棋盘格和ChArUco标定板的生成和角点检测。

### src/calibration.py
标定核心算法模块，实现针孔和鱼眼相机模型的标定算法。

### src/detection.py
角点检测算法模块，包含棋盘格和ChArUco角点检测算法。

### src/utils.py
通用工具函数模块，包含文件保存、误差计算等辅助函数。

## 技术细节

### 标定板参数

- **ChArUco标定板**：A4纸张，DICT_4X4_1000字典，7×10棋盘格，25.0mm方格长度，17.5mm标记长度
- **棋盘格标定板**：默认9×6内角点，25.0mm方格长度（可自定义）

### 支持的模型

- **针孔模型**：适用于大多数普通摄像头，支持k1, k2, p1, p2, k3五个畸变系数
- **鱼眼模型**：适用于广角摄像头，支持k1, k2, k3, k4四个畸变系数

### 标定结果

标定完成后会生成：
- 内参矩阵（3×3）
- 畸变系数向量
- 重投影误差（用于评估标定质量）

## 开发说明

本项目已重构为模块化结构，从前端界面到后端算法。核心标定功能在 `src/` 目录下的各个模块中实现，Flask应用提供Web界面和API接口。

## 注意事项

- 标定图像数量越多，标定结果越准确（建议至少10张）
- 标定板应在画面中清晰可见，避免反光或阴影
- 捕获标定图像时，应覆盖整个视野范围的不同位置和角度
- 标定完成后，重投影误差越小表示标定质量越高（通常应小于1.0像素）
- 不同的相机模型（针孔/鱼眼）会产生不同的标定结果，请根据实际摄像头类型选择